{%- paginate collection.products by section.settings.products_per_page -%}
<section class="section-spacing">
  <div class="page-width">
    <div class="collection-header">
      <h1 class="collection-header__title h1">{{ collection.title }}</h1>
      {%- if collection.description != blank -%}
        <div class="collection-header__description rich-text">{{ collection.description }}</div>
      {%- endif -%}
    </div>

    <div class="collection-toolbar">
      <p class="collection-toolbar__count">
        {{ 'collections.general.products_count' | t: count: collection.products_count }}
      </p>
      <div class="collection-toolbar__sort">
        <label for="sort-by">{{ 'collections.general.sort_by' | t }}</label>
        <select id="sort-by" class="form-select" onchange="window.location.href = this.value">
          {%- for option in collection.sort_options -%}
            <option
              value="{{ collection.url }}?sort_by={{ option.value }}"
              {% if collection.sort_by == option.value %} selected{% endif %}
            >
              {{ option.name }}
            </option>
          {%- endfor -%}
        </select>
      </div>
    </div>

    {%- if collection.products.size > 0 -%}
      <div class="grid grid--{{ section.settings.columns }}">
        {%- for product in collection.products -%}
          {% render 'product-card', product: product, show_vendor: section.settings.show_vendor %}
        {%- endfor -%}
      </div>

      {%- if paginate.pages > 1 -%}
        <nav class="pagination" aria-label="Pagination">
          {%- if paginate.previous -%}
            <a href="{{ paginate.previous.url }}" class="pagination__item" aria-label="Previous page">
              {% render 'icon-arrow', direction: 'left' %}
            </a>
          {%- endif -%}

          {%- for part in paginate.parts -%}
            {%- if part.is_link -%}
              <a href="{{ part.url }}" class="pagination__item">{{ part.title }}</a>
            {%- else -%}
              {%- if part.title == paginate.current_page -%}
                <span class="pagination__item is-current" aria-current="page">{{ part.title }}</span>
              {%- else -%}
                <span class="pagination__item">{{ part.title }}</span>
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}

          {%- if paginate.next -%}
            <a href="{{ paginate.next.url }}" class="pagination__item" aria-label="Next page">
              {% render 'icon-arrow', direction: 'right' %}
            </a>
          {%- endif -%}
        </nav>
      {%- endif -%}
    {%- else -%}
      <div class="text-center" style="padding: 3rem 0;">
        <p class="text-muted">{{ 'collections.general.no_products' | t }}</p>
      </div>
    {%- endif -%}
  </div>
</section>
{%- endpaginate -%}

{% schema %}
{
  "name": "Collection page",
  "tag": "section",
  "class": "main-collection-section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 36,
      "step": 4,
      "default": 16,
      "label": "Products per page"
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 4,
      "label": "Columns"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": true,
      "label": "Show vendor"
    }
  ]
}
{% endschema %}
