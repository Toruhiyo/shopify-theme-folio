{%- comment -%}
  Renders a product card.
  Accepts:
  - product: {Object} Shopify product object
  - show_vendor: {Boolean} Show vendor label (default: false)
  - lazy_load: {Boolean} Lazy load images (default: true)
{%- endcomment -%}

{%- liquid
  assign show_vendor = show_vendor | default: false
  assign lazy_load = lazy_load | default: true

  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif

  assign sold_out = true
  if product.available
    assign sold_out = false
  endif
-%}

<div class="product-card">
  <div class="product-card__media">
    {%- if product.featured_media -%}
      <a href="{{ product.url }}" aria-label="{{ product.title | escape }}">
        <img
          src="{{ product.featured_media | image_url: width: 600 }}"
          alt="{{ product.featured_media.alt | escape | default: product.title | escape }}"
          width="{{ product.featured_media.width }}"
          height="{{ product.featured_media.height }}"
          {% if lazy_load %}loading="lazy" decoding="async"{% endif %}
        >
      </a>
    {%- else -%}
      <a href="{{ product.url }}" aria-label="{{ product.title | escape }}">
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
      </a>
    {%- endif -%}

    <div class="product-card__badges">
      {%- if sold_out -%}
        <span class="product-card__badge product-card__badge--sold-out">{{ 'products.product.sold_out' | t }}</span>
      {%- elsif on_sale -%}
        <span class="product-card__badge product-card__badge--sale">{{ 'products.product.sale' | t }}</span>
      {%- endif -%}
    </div>

    {%- unless sold_out -%}
      <div class="product-card__quick-add">
        {%- form 'product', product, data-product-form: '' -%}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          <button type="submit" class="btn btn--small" data-add-text="{{ 'products.product.add_to_cart' | t }}" data-adding-text="{{ 'products.product.adding' | t }}">
            {{ 'products.product.add_to_cart' | t }}
          </button>
        {%- endform -%}
      </div>
    {%- endunless -%}
  </div>

  <div class="product-card__content">
    {%- if show_vendor and product.vendor != blank -%}
      <span class="product-card__vendor label-caps text-muted">{{ product.vendor }}</span>
    {%- endif -%}

    <h3 class="product-card__title">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>

    <div class="product-card__price">
      {%- if on_sale -%}
        <span class="product-card__price--sale">{{ product.price | money }}</span>
        <span class="product-card__price--compare">{{ product.compare_at_price | money }}</span>
      {%- else -%}
        <span>{{ product.price | money }}</span>
      {%- endif -%}
    </div>
  </div>
</div>
